import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

# Device Control

We've connected, we've enumerated, now it's time for the important stuff. Device Control!

## Device Capabilities

The devices Buttplug supports can do many different things. They may vibrate, stroke, rotate, some
combination of all of these, or possibly something completely different.

In order to trigger these different mechanisms, OutputCmd Messages are used. For now we'll just look
at vibrating and stopping, but there's descriptions of other messages in the Winning Ways section.

When a device is added, it comes with a list of features that OutputCmd can refer to, as well as
certain parameters for those features. For instance, if you have a vibrating buttplug (an actual
buttplug toy) can be accessed using the following messages:

- OutputCmd
  - This will take a feature index, feature type (for this, Vibrate), and a value in steps/percent,
    which the client library is expected to turn into a message for you.
- StopCmd
  - This command takes no arguments, and simply stops a feature/device from whatever its doing. The
    Buttplug Server has enough information to know what actions a device or feature can perform, so
    it handles making sure all of those actions are stopped.

You'll usually interact with devices with Device instances, which will be different than the
Buttplug Client. While the Client handles things like scanning and device lists, a Device instance
will let you command a specific device.

:::tip Didn't we used to be able to update multiple features at a time?

Yes!

And it was really complicated!

And almost no one used that functionality!

And something like < 10% of the devices we support even have > 1 output features!

In the Buttplug v4 message spec, we now put the burden of messages aggregation on the Server. Users
send one command for one feature of one device, and we do the work on the backend to smash all of
those commands together into the smallest possible packet to go to the hardware. If you're curious
about the way this works, check the [Devices and Commands section of this
guide](../cookbook/devices-and-commands/intro.md).

:::

## Sending Device Messages

As a user of a Buttplug Client API, you should never be expected to send raw Buttplug Messages. Most
Client APIs will provide message sending functions for you, usually attached to device objects or
structures. If the device accepts the message type represented by the function you call, it should
be sent to the device. Otherwise, you'll receive an error about message compatibility.

<Tabs groupId="examples">
<TabItem value="rust" label="Rust">

import RustControlExample from '!!raw-loader!/examples/v4/rust/device_control.rs';

<CodeBlock language="rust">{RustControlExample}</CodeBlock>

</TabItem>
<TabItem value="csharp" label="C#">

import CSharpControlExample from '!!raw-loader!/examples/v4/csharp/DeviceControlExample/Program.cs';

<CodeBlock language="csharp">{CSharpControlExample}</CodeBlock>

</TabItem>
<TabItem value="js" label="Javascript (Web)">

{/* NOTE: These are browser examples. Include Buttplug via CDN in your HTML:
    <script src="https://cdn.jsdelivr.net/npm/buttplug@4.0.0/dist/web/buttplug.min.js"></script> */}

import jsControlExample from '!!raw-loader!/examples/v4/javascript/device-control-example.js';

<CodeBlock language="js">{jsControlExample}</CodeBlock>

</TabItem>
<TabItem value="ts" label="TypeScript">

import tsControlExample from '!!raw-loader!/examples/v4/typescript/device-control-example.ts';

<CodeBlock language="typescript">{tsControlExample}</CodeBlock>

</TabItem>
<TabItem value="python" label="Python">

import PythonControlExample from '!!raw-loader!/examples/v4/python/device_control.py';

<CodeBlock language="python">{PythonControlExample}</CodeBlock>

</TabItem>
</Tabs>
